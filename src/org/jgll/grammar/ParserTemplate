/**
 * This code is automatically generated.
 * Changes to this file may cause incorrect behavior and will be lost when the code is regenerated.
 */
 
package ${packageName};

import org.jgll.parser.Descriptor;
import org.jgll.parser.GLLParser;
import org.jgll.parser.GSSNode;
import org.jgll.exception.ParsingFailedException;
import org.jgll.grammar.Grammar;
import org.jgll.sppf.NonterminalSymbolNode;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class ${className}Parser extends GLLParser {
	
	private static final Logger log = LoggerFactory.getLogger(${className}Parser.class);
	
	private static final int L0 = -1; 
	
	/**
	 * The current grammar label
	 */
	private int label;
		
	public ${className}Parser(Grammar grammar) {
		this.grammar = grammar;
	}
	
	@Override
	public void init(int inputSize) {
			
		lookup = new org.jgll.lookup.MapLevelledLookup(grammar, inputSize);
		descriptorSet =  new org.jgll.parser.LevelledDescritorSet(inputSize + 1, (org.jgll.lookup.LevelledLookup) lookup);
			
		ci = 0;
		cu = u0 = GSSNode.DUMMY;
		cn = DUMMY;

		errorIndex = -1;
		errorNonterminal = null;
	}
		
	@Override
	public NonterminalSymbolNode parse(String input) throws ParsingFailedException {

		I = new int[input.length() + 1];
		for (int i = 0; i < input.length(); i++) {
			I[i] = input.charAt(i);
		}
		I[input.length()] = -1;
		log.info("Input size: {}", input.length());
		
		long start = System.nanoTime();
		
		init(input.length());
	
		label = ${grammar.startSymbol.id};
		
		long end = System.nanoTime();
		log.info("Initialization time: {} ms", (end - start) / 1000000);		

		start = System.nanoTime();

		while (true) {
			switch (label) {
			case L0:
				if (!descriptorSet.isEmpty()) {
					Descriptor descriptor = descriptorSet.nextDescriptor();					
					cu = descriptor.getGSSNode();
					ci = descriptor.getInputIndex();
					cn = descriptor.getSPPFNode();
					label = descriptor.getLabel();
					break;
				}
				else {
					end = System.nanoTime();
					
					NonterminalSymbolNode root = lookup.getStartSymbol();
										
					if(root == null) {
						log.info("Parsing failed.");
						throw new ParsingFailedException(errorNonterminal, errorIndex, input);
					} 
		
					log.info("Parsing Time: {} ms", (end - start)/1000000);
					
					int mb = 1024 * 1024;
					Runtime runtime = Runtime.getRuntime();
					log.info("Memory used: {} mb", (runtime.totalMemory() - runtime.freeMemory()) / mb);
					log.info("Descriptors: {}", descriptorSet.sizeAll());
					log.info("Non-packed nodes: {}", lookup.sizeNonPackedNodes());
					
					return root;
				}

// The generated code will come here!
